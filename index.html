`<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SMM Panel Indosmm.id</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1565c0, #42a5f5);
    color: #fff;
    margin: 0; padding: 0;
  }
  .container {
    max-width: 480px;
    margin: 40px auto;
    background: rgba(255 255 255 / 0.1);
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 8px 24px rgb(0 0 0 / 0.3);
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
  }
  input, select, button {
    width: 100%;
    margin: 8px 0 16px 0;
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
  }
  button {
    background-color: #0d47a1;
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #1565c0;
  }
  .hidden { display: none; }
  .error { color: #ff8a80; margin-bottom: 12px; }
  .success { color: #a5d6a7; margin-bottom: 12px; }
  label {
    font-weight: 600;
  }
  nav {
    margin-bottom: 20px;
    display: flex;
    justify-content: space-around;
  }
  nav button {
    width: auto;
    padding: 8px 16px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  table, th, td {
    border: 1px solid #ffffff80;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
</style>
</head>
<body>

<div class="container">
  <h1>SMM Panel Indosmm.id</h1>

  <nav>
    <button id="nav-login">Login</button>
    <button id="nav-order" class="hidden">Order</button>
    <button id="nav-status" class="hidden">Status Order</button>
    <button id="nav-logout" class="hidden" style="background:#b71c1c;">Logout</button>
  </nav>

  <!-- Login Form -->
  <div id="page-login">
    <div id="login-msg" class="error"></div>
    <label>Username</label>
    <input type="text" id="login-user" />
    <label>Password</label>
    <input type="password" id="login-pass" />
    <button id="btn-login">Login</button>
  </div>

  <!-- Order Form -->
  <div id="page-order" class="hidden">
    <div id="order-msg"></div>
    <label>Layanan</label>
    <select id="service-select">
      <option>Loading layanan...</option>
    </select>
    <label>Link / Username</label>
    <input type="text" id="order-link" placeholder="Masukkan link/username target" />
    <label>Jumlah</label>
    <input type="number" id="order-quantity" min="1" value="10" />
    <button id="btn-order">Kirim Order</button>
  </div>

  <!-- Status Order -->
  <div id="page-status" class="hidden">
    <h3>Status Pesanan Kamu</h3>
    <table id="status-table">
      <thead>
        <tr>
          <th>ID Order</th>
          <th>Layanan</th>
          <th>Link</th>
          <th>Jumlah</th>
          <th>Status</th>
          <th>Tanggal</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="6" style="text-align:center">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
const apiBase = "api.php";

let currentUser = null;

// Navigasi antar halaman
const navLogin = document.getElementById('nav-login');
const navOrder = document.getElementById('nav-order');
const navStatus = document.getElementById('nav-status');
const navLogout = document.getElementById('nav-logout');

const pageLogin = document.getElementById('page-login');
const pageOrder = document.getElementById('page-order');
const pageStatus = document.getElementById('page-status');

function showPage(page) {
  pageLogin.classList.add('hidden');
  pageOrder.classList.add('hidden');
  pageStatus.classList.add('hidden');
  page.classList.remove('hidden');
}

function updateNav() {
  if(currentUser){
    navLogin.classList.add('hidden');
    navOrder.classList.remove('hidden');
    navStatus.classList.remove('hidden');
    navLogout.classList.remove('hidden');
  } else {
    navLogin.classList.remove('hidden');
    navOrder.classList.add('hidden');
    navStatus.classList.add('hidden');
    navLogout.classList.add('hidden');
  }
}

navLogin.onclick = () => { showPage(pageLogin); }
navOrder.onclick = () => { showPage(pageOrder); }
navStatus.onclick = () => { loadStatus(); showPage(pageStatus); }
navLogout.onclick = () => {
  currentUser = null;
  localStorage.removeItem('smmuser');
  updateNav();
  showPage(pageLogin);
}

// Simpan session user sederhana di localStorage
function setUser(user) {
  currentUser = user;
  localStorage.setItem('smmuser', JSON.stringify(user));
  updateNav();
}

function getUser() {
  const u = localStorage.getItem('smmuser');
  if(u) return JSON.parse(u);
  return null;
}

// Load session user kalau ada
window.onload = () => {
  const u = getUser();
  if(u) {
    currentUser = u;
    updateNav();
    showPage(pageOrder);
    loadServices();
  } else {
    showPage(pageLogin);
  }
};

// Login
document.getElementById('btn-login').onclick = async () => {
  const user = document.getElementById('login-user').value.trim();
  const pass = document.getElementById('login-pass').value.trim();
  const loginMsg = document.getElementById('login-msg');
  loginMsg.textContent = "";

  if(!user || !pass){
    loginMsg.textContent = "Username dan password tidak boleh kosong!";
    return;
  }

  const res = await fetch(apiBase + '?action=login', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username: user, password: pass})
  });
  const data = await res.json();

  if(data.success){
    setUser({username: user});
    loginMsg.textContent = "";
    loadServices();
    showPage(pageOrder);
  } else {
    loginMsg.textContent = data.message || "Login gagal";
  }
}

// Load daftar layanan dari api.php (yang fetch ke Indosmm)
async function loadServices(){
  const sel = document.getElementById('service-select');
  sel.innerHTML = "<option>Loading layanan...</option>";

  try {
    const res = await fetch(apiBase + '?action=services');
    const data = await res.json();
    if(data.success && data.services){
      sel.innerHTML = "";
      for(const svc of data.services){
        sel.innerHTML += `<option value="${svc.service}">${svc.name} - Rp${svc.price}</option>`;
      }
    } else {
      sel.innerHTML = "<option>Tidak ada layanan</option>";
    }
  } catch {
    sel.innerHTML = "<option>Gagal memuat layanan</option>";
  }
}

// Kirim order
document.getElementById('btn-order').onclick = async () => {
  const service = document.getElementById('service-select').value;
  const link = document.getElementById('order-link').value.trim();
  const quantity = document.getElementById('order-quantity').value;
  const orderMsg = document.getElementById('order-msg');

  orderMsg.textContent = "";
  orderMsg.className = "";

  if(!service || !link || quantity <= 0){
    orderMsg.textContent = "Semua data harus diisi dengan benar.";
    orderMsg.className = "error";
    return;
  }

  if(!currentUser){
    orderMsg.textContent = "Silakan login terlebih dahulu.";
    orderMsg.className = "error";
    return;
  }

  try {
    const res = await fetch(apiBase + '?action=order', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        username: currentUser.username,
        service,
        link,
        quantity
      })
    });
    const data = await res.json();
    if(data.success){
      orderMsg.textContent = "Order berhasil dibuat, ID Order: " + data.order_id;
      orderMsg.className = "success";
      document.getElementById('order-link').value = "";
      document.getElementById('order-quantity').value = 10;
    } else {
      orderMsg.textContent = data.message || "Order gagal.";
      orderMsg.className = "error";
    }
  } catch (e) {
    orderMsg.textContent = "Terjadi kesalahan saat membuat order.";
    orderMsg.className = "error";
  }
}

// Load status order user
async function loadStatus(){
  if(!currentUser) return;

  const tbody = document.querySelector("#status-table tbody");
  tbody.innerHTML = "<tr><td colspan='6' style='text-align:center'>Loading...</td></tr>";

  try {
    const res = await fetch(apiBase + '?action=status&username=' + encodeURIComponent(currentUser.username));
    const data = await res.json();

    if(data.success && data.orders && data.orders.length){
      tbody.innerHTML = "";
      for(const o of data.orders){
        tbody.innerHTML += `<tr>
          <td>${o.order_id}</td>
          <td>${o.service_name}</td>
          <td>${o.link}</td>
          <td>${o.quantity}</td>
          <td>${o.status}</td>
          <td>${o.created_at}</td>
        </tr>`;
      }
    } else {
      tbody.innerHTML = "<tr><td colspan='6' style='text-align:center'>Tidak ada order.</td></tr>";
    }
  } catch {
    tbody.innerHTML = "<tr><td colspan='6' style='text-align:center'>Gagal memuat status order.</td></tr>";
  }
}
</script>

</body>
</html>
